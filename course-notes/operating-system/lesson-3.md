
---
title: 操作系统 Lesson 3
tag: [](/index.md)
---

<style>
hint {
  color: gray;  
}
em {
  color: rgb(249, 117, 131);
  font-style: normal;
}
</style>

### 挂起原因

1. 终端用户的需要. 自己程序运行期间发现可疑问题.
1. 父进程请求. 父进程希望挂起自己子进程.
1. 负荷调节的需要. 实时系统工作负荷较重, 影响对实时任务的控制.
1. 操作系统的需要. 检查运行中的资源使用情况或进行记账

<p style="text-align: center;"><img src="../../assets/seven-state.svg" style="border-radius: 0.2em; width: 800px;"><br>七态模型</p>

### 进程的结构
<div style="display: flex; column-gap: 0.5em;">
<div>

- 进程控制块 (PCB)
- 数据段
- 程序段

</div>
<p style="text-align: center;"><img src="../../assets/process.svg" style="border-radius: 0.2em; width: 300px;"><br>进程的结构</p>
</div>

### 进程控制块 [PCB] 的定义

- 系统为了 *管理* 进程而设置的一个 *数据结构*. 
- 记录操作系统所需要的、用于描述进程的 *当前信息* 以及控制进程运行的 *全部信息*. 
- 操作系统通过 *PCB* 感知进程的存在. 
- PCB 是进程存在的 *唯一标志*. 
- PCB 和进程是 *一一对应*. 

#### PCB 的构成

- 标识符. 唯一地标识一个进程. 
  - 内部标识符. 
  - 外部标识符. 
- 调度信息. 进程状态转换需要的信息. 
- 处理机. 处理机中断或调用, 保护或恢复现场信息. 
- 控制信息. 控制进程执行的节奏. 

#### PCB 的组织方式

- 线性
  - 将所有 PCB 不分状态组织在一个连续表
  - 优点: 简单、且不需要额外开销
  - 缺点: 需扫描整个 PCB 表才能找到需要的 PCB
  - 适应进程数目不多的系统
- 链接
  - 将状态相同的 PCB 链接起来
  - 等待队列可以有多个
  - 就绪队列排队和调度算法有关
- 索引
  - 在链接方式的指针和 PCB 间加入索引表, 即二级索引

### 内核

- 内核是计算机操作系统的核心程序, 始终对系统中的所有内容拥有完全控制权. 
- 内核还负责防止和缓解不同进程之间的冲突. 它是始终驻留在内存中的操作系统代码部分, 并促进硬件和软件组件之间的交互. 
- 完整的内核通过设备驱动程序控制所有硬件资源 (例如 I/O、内存、加密), 仲裁涉及此类资源的进程冲突, 并优化常用资源的利用率. <hint>例如 CPU 和缓存使用、文件系统和网络套接字. 在大多数系统中, 内核是启动时首先加载的程序之一 (在引导加载程序之后). 它处理启动的其余部分, 以及来自软件的内存、外围设备和输入 / 输出 (I/O) 请求, 将它们转换为中央处理单元的数据处理指令. </hint>

### 中断和异常的处理

#### 中断的作用

1. 中断会使 CPU 由用户态变为内核态, OS 重新夺回对 CPU 的控制权. (硬件实现)
1. 如果没有中断机制, 就无法进行并发.
1. 中断是操作系统内核夺回 CPU 使用权的唯一途径 (用户态 $\to$ 内核态)

#### 中断的类型

1. 内中断 (异常、例外、陷入)
    1. 与当前执行的指令有关, *中断信号来源于 CPU 内部*, 由某个指令引发的中断.
    1. 陷阱、陷入 [trap]: 由陷入指令引发的, 应用程序故意引发, 如: 系统调用.(陷入指令并非特权指令, 且需要在用户态下执行, 系统调用通过陷入指令完成)
    1. 故障 [fault]: 由错误条件引起, 可能被内核程序修复, CPU 使用权交还给应用程序. 如: 缺页故障.
    1. 终止 [abort]: 由致命错误引起, 内核程序无法修复该错误, 并且不会交还 CPU 使用权, 而是直接终止应用程序. 如: 除法指令除数为 0 (有争议)、非法使用特权指令.
1. 外中断 (也称中断)
    1. 与当前执行的指令无关, *中断信号来源于 CPU 外部*.
    1. 时钟中断: 由时钟部件发来的中断信号, 时钟部件每隔一个时间片, 归给CPU 发送一个时钟中断信号.
    1. I/O 中断: 由输入输出设备发来的中断信号.

*异常会引起中断, 中断未必是异常引起的.* 
